---
title: "Data Preparation"
output: html_document
date: "2024-02-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(readxl)
```

Import data
```{r}
df <- read_xlsx("loan_data_ADA_assignment.xlsx",sheet="in")
```

See structure and summary
```{r}
str(df)
summary(df)
```
Detect NA value
```{r}
sum(is.na(df))
```
See the percentage of missing data of the column mths_since_last_delinq
```{r}
sum(is.na(df$mths_since_last_delinq))/nrow(df)
```
See the percentage of missing data of the column mths_since_last_record
```{r}
sum(is.na(df$mths_since_last_record))/nrow(df)
#because the percentage is high, drop the column
```
See the percentage of missing data of the column mths_since_last_major_derog
```{r}
sum(is.na(df$mths_since_last_major_derog))/nrow(df)
#because the percentage is high, drop the column
```

Made a list of column that need to drop
```{r}
drop_column <- c('id','member_id','funded_amnt_inv','emp_title','issue_d','desc','title','zip_code','earliest_cr_line','total_pymnt_inv','total_rec_prncp','total_rec_int','total_rec_late_fee','recoveries','collection_recovery_fee','last_pymnt_d','last_pymnt_amnt','next_pymnt_d','collections_12_mths_ex_med','policy_code','addr_state','term','home_ownership','verification_status','purpose','loan_is_bad','pymnt_plan','grade','mths_since_last_major_derog','mths_since_last_record')
```

Drop the column
```{r}
df2 <- df %>% select(-drop_column)
```

Change NA value to zero
```{r}
#df2$mths_since_last_record[is.na(df2$mths_since_last_record)] <- 0

#df2$mths_since_last_delinq[is.na(df2$mths_since_last_delinq)] <- 0
```

Drop missing data
```{r}
df3 <- na.omit(df2)
```

Make a sample 500
```{r}
set.seed(100)
sample <- sample_n(df3, 500)
```

### Integer encoding
subgrade
```{r}
sample$sub_grade <- recode(sample$sub_grade,"A1"=35,"A2"=34,"A3"=33,"A4"=32,"A5"=31,"B1"=30,"B2"=29,"B3"=28,"B4"=27,"B5"=26,"C1"=25,"C2"=24,"C3"=23,"C4"=22,"C5"=21,"D1"=20,"D2"=19,"D3"=18,"D4"=17,"D5"=16,"E1"=15,"E2"=14,"E3"=13,"E4"=12,"E5"=11,"F1"=10,"F2"=9,"F3"=8,"F4"=7,"F5"=6,"G1"=5,"G2"=4,"G3"=3,"G4"=2,"G5"=1)
```
Loan Status
```{r}
#check the level
sample$loan_status <- as.factor(sample$loan_status)
levels(sample$loan_status)
#level still based on assumption
sample$loan_status <- recode(sample$loan_status,"Charged Off"=1,"Late (31-120 days)"=2,"Late (16-30 days)"=3,"In Grace Period"=4, "Fully Paid"=5,"Current"=6)
```

